{% extends 'detect/base.html' %}
{% block title %}이미지 업로드{% endblock %}

{% block content %}
<style>

    .glass-card {
        background: #ffffff;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 25px;
        border: 1px solid #ddd;
    }

    .glass-title {
        font-size: 20px;
        color: #222;
        font-weight: 700;
        margin-bottom: 18px;
    }

    .form-control {
        background: #f5f5f5;
        color: #000;
        border: 1px solid #ccc;
    }

    .form-control:focus {
        border-color: #0095ff;
        box-shadow: 0 0 6px rgba(0,149,255,0.5);
        color: #000;
    }

    .upload-btn {
        background: #007bff;
        border: none;
        font-weight: 600;
        padding: 10px;
        border-radius: 8px;
        color: #fff;
    }

    .upload-btn:hover {
        background: #0a84ff;
    }

    /* 삭제 버튼 */
    .delete-btn {
        background: #d9534f;
        border: none;
        font-weight: 600;
        padding: 12px;
        border-radius: 8px;
        margin-top: 15px;
        color: #fff;
    }
    .delete-btn:hover {
        background: #c9302c;
    }

    /* 이미지 그리드 */
    .img-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .img-box {
        background: #f9f9f9;
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 10px;
        text-align: center;
        position: relative;
        transition: 0.2s;
        cursor: pointer;
    }

    .img-box:hover {
        background: #fff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transform: translateY(-3px);
    }

    .check {
        position: absolute;
        top: 8px;
        left: 8px;
        transform: scale(1.3);
        cursor: pointer;
    }

    .thumb-img {
        width: 100%;
        height: 110px;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #ddd;
    }

    .img-label {
        margin-top: 8px;
        font-size: 13px;
        font-weight: 600;
        color: #333;
    }

    input[type="file"] {
        color: #bdbdbd;
    }
</style>

<div class="container mt-4">

    <div class="glass-card">
        <div class="glass-title">이미지 업로드</div>

        <form method="post" enctype="multipart/form-data" novalidate>
            {{ form.csrf_token }}

            <label>업로드할 이미지 선택</label>
            {{ form.image(class="form-control mb-3") }}

            {% for error in form.image.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}

            <button class="btn upload-btn w-100">업로드</button>
        </form>
    </div>

    <!-- 이미지 목록 -->
    <div class="glass-card">
        <div class="glass-title">이미지 목록</div>

        <form method="POST" action="{{ url_for('detect.delete_selected_images') }}">
            {{ delete_form.csrf_token }}

            {% if images %}
            <div class="mb-2">
                <input type="checkbox" id="check_all" style="transform:scale(1.2); margin-right:5px;">
                <label for="check_all">전체 선택</label>
            </div>

            <div class="img-grid">
                {% for img in images %}
                <label class="img-box">
                    <input type="checkbox" class="check" name="delete_ids" value="{{ img.id }}">
                    <img src="{{ url_for('detect.images', filename=img.image_path) }}" class="thumb-img">
                    <div class="img-label">#{{ loop.index }}</div>
                </label>
                {% endfor %}
            </div>

            <button type="submit" class="btn delete-btn w-100"
                    onclick="return confirm('선택한 이미지를 삭제할까요?');">
                선택 삭제
            </button>

            {% else %}
                <p class="text-muted">감지된 이미지가 없습니다.</p>
            {% endif %}
        </form>
    </div>
        <div class="mt-3 mb-4">
        <a href="{{ url_for('detect.image_dashboard') }}"
           class="btn btn-outline-dark"
           style="font-size: 0.85rem; padding: 7px 16px; border-radius: 6px;">
            ← 이미지 목록으로 돌아가기
        </a>
    </div>

</div>

<script>
    const checkAll = document.getElementById("check_all");
    const checks = document.querySelectorAll(".check");

    if (checkAll) {
        checkAll.addEventListener("change", () => {
            checks.forEach(c => c.checked = checkAll.checked);
        });
    }
</script>

{% endblock %}
